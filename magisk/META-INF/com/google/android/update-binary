#!/sbin/sh
#
# Initialiser, simple MMT
# Written by UsiFX, pedrozzz0
#
# Copyright Identiter: GPL-3.0
# Copyright (C) 2022~2023 UsiFX <xprjkts@gmail.com>
#

umask 022

# Echo before loading util_functions
ui_print() { echo "$1"; }

rmtouch() { [[ -e "$1" ]] && rm -rf "$1" 2>/dev/null; }

####################
# SETUP ENVIRONMENT
####################

OUTFD="$2"
ZIPFILE="$3"

mount /data 2>/dev/null

# Load utility functions
. /data/adb/magisk/util_functions.sh

# Preperation for flashable zips
setup_flashable

# Mount partitions
mount_partitions

# Detect version and architecture
api_level_arch_detect

# Setup busybox and binaries
$BOOTMODE && boot_actions || recovery_actions

install_module
exit 0
